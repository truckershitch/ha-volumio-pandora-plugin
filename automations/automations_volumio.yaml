### VOLUMIO ###

- id: set_options_input_select_hornet_station
  alias: Load Hornet stations
  trigger:
  - platform: homeassistant
    event: start
  - platform: mqtt
    topic: volumio/pandora/stationData
  action:
  - service: pyscript.update_options
    data:
      entity_id: input_select.hornet_station
      retain_state: hell yes
      options_csv: >-
        {% if trigger.payload_json != Undefined %}
          {{ 'None,' }}
          {% for staId in trigger.payload_json %}
            {{ trigger.payload_json[staId]['name'] }}
            {% if not loop.last %}
              {{ ',' }}
            {% endif %}
          {% endfor %}
        {% else %}
          {{ 'None' }}
        {% endif %}

- id: select_option_input_select_hornet_station
  alias: Update Hornet station in HA when station changes
  trigger:
  - platform: mqtt
    topic: volumio/pandora/stationName
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.hornet_station
    data:
      option: '{{ trigger.payload_json.stationName }}'
  # - service: persistent_notification.create
  #   data_template:
  #     message: '{{ trigger.payload_json.stationName }}'

- id: play_hornet_station_on_volumio
  alias: Play Hornet station on Volumio
  trigger:
  - platform: template
    value_template: "{{ states('input_select.hornet_station') is not none and states('input_select.hornet_station') != 'None' }}"
  action:
  - service: shell_command.play_volumio_pandora_station
    data_template:
      newStation: "{{ states('input_select.hornet_station') }}"